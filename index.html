<!-- Añadir en <head> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Dentro del <script> existente, añadir al final: -->
<script>
const jsonUrl = "TU_URL_DEL_ENDPOINT_JSON"; // <-- reemplaza con tu URL real
let fechasNoDisponibles = {};

// Función para inicializar el calendario
function iniciarCalendario() {
  flatpickr("#fecha", {
    dateFormat: "Y-m-d",
    minDate: "today",
    disable: [
      function(date) {
        const fechaStr = date.toISOString().split("T")[0];
        const pueblo = document.getElementById("pueblo").value.trim();
        if (fechasNoDisponibles[fechaStr] && fechasNoDisponibles[fechaStr][pueblo] === "NO") {
          return true;
        }
        return false;
      }
    ]
  });
}

fetch(jsonUrl)
  .then(res => res.json())
  .then(data => {
    fechasNoDisponibles = data;
  })
  .catch(err => console.error("Error cargando fechas no disponibles:", err));

document.getElementById("pueblo").addEventListener("input", () => {
  const calendario = document.querySelector("#fecha")._flatpickr;
  calendario.redraw();
});
</script>

<!-- Reordenar campos del formulario en HTML -->
<form id="pedidoForm">
  <h2>Haz tu pedido de gasoil</h2>

  <label for="zona">Zona de reparto:</label>
  <select id="zona" name="zona" onchange="showPueblos();" required>
    <option value="">Seleccione una zona</option>
    <option value="sierraNorte">Sierra Norte</option>
    <option value="sierraOeste">Sierra Oeste</option>
  </select>

  <label for="pueblo">Pueblo:</label>
  <input list="listaPueblos" id="pueblo" name="pueblo" required />
  <datalist id="listaPueblos"></datalist>

  <div id="avisoPueblo" style="color: red; font-weight: bold; display: none;"></div>

  <label for="fecha">Fecha de preferencia:</label>
  <input type="text" id="fecha" name="fecha" required />

  <label for="direccion">Dirección:</label>
  <input type="text" id="direccion" name="direccion" required />

  <label for="cantidad">Cantidad (mínimo 300 litros):</label>
  <input type="number" id="cantidad" name="cantidad" min="300" required />

  <label for="nombre">Nombre:</label>
  <input type="text" id="nombre" name="nombre" required />

  <label for="telefono">Teléfono:</label>
  <input type="tel" id="telefono" name="telefono" required />

  <label for="email">Correo electrónico:</label>
  <input type="email" id="email" name="email" required />

  <label for="observaciones">Observaciones:</label>
  <textarea id="observaciones" name="observaciones" rows="4"></textarea>

  <label>
    <input type="checkbox" id="consentimiento" name="consentimiento" required />
    Acepto los términos y condiciones y la política de privacidad.
  </label>

  <input type="submit" value="Enviar Pedido" />
</form>

<div id="mensaje">
  <div class="check-icon">✅</div>
  <div>Pedido enviado correctamente.<br><strong>Gracias por confiar en Grupo Geslama.</strong></div>
</div>

<script>
  const pueblosPorZona = {
    sierraNorte: ["Berrueco", "Bustarviejo", "Cabanillas de la Sierra", "El Molar", "Guadalix de la Sierra", "La Cabrera", "Lozoyuela", "Pedrezuela", "San Agustín del Guadalix", "Venturada"],
    sierraOeste: ["Aldea del Fresno", "Cebreros", "Chapinería", "Colmenar del Arroyo", "El Tiemblo", "Fresnedillas de la Oliva", "Navalagamella", "Navas del Rey", "Pelayos de la Presa", "Quijorna", "Robledo de Chavela", "San Martín de Valdeiglesias", "Villamanta", "Villamantilla", "Villanueva de Perales"]
  };

  function showPueblos() {
    const zona = document.getElementById("zona").value;
    const lista = document.getElementById("listaPueblos");
    lista.innerHTML = "";
    if (pueblosPorZona[zona]) {
      pueblosPorZona[zona].forEach(p => {
        const option = document.createElement("option");
        option.value = p;
        lista.appendChild(option);
      });
    }
    document.getElementById("pueblo").value = "";
  }

  document.getElementById("pueblo").addEventListener("input", () => {
    const pueblo = document.getElementById("pueblo").value;
    const aviso = document.getElementById("avisoPueblo");
    if (pueblo === "La Cabrera") {
      aviso.style.display = "block";
      aviso.textContent = "Los pedidos para La Cabrera solo se entregan martes y viernes.";
    } else {
      aviso.style.display = "none";
    }
    // Iniciar calendario después de seleccionar el pueblo
    iniciarCalendario();
  });
</script>
